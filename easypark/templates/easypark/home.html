<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy Parking - จองที่จอดรถ</title>
    <link href="{% static 'css/styles.css' %}" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
        }

        .headers, .header {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 10px 0;
        }

        .headers { font-size: 50px; }
        .header { font-size: 20px; }

        .banner img {
            width: 100%;
            height: auto;
        }

        .navigation {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .content {
            text-align: center;
            margin: 30px 0;
        }

        #camera-section {
            display: none;
            max-height: 0;
            transition: max-height 0.8s ease-out, opacity 0.8s ease-in;
        }

        /* Modal Styles */
        #login-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        #modal-background {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9;
        }
    </style>
</head>

<body>
    <div class="headers">EASY PARKING</div>
    <div class="header">
        <div class="navigation">
            <button id="start-btn" class="mt-6 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">
                เริ่มต้นใช้งาน
            </button>
        </div>
    </div>

    <div class="banner">
        <img src="{% static 'image/banner.gif' %}" alt="Easy Parking Banner">
    </div>

    <div class="content">
        <h2>จองที่จอดรถ</h2>
        <p>Easy Park Easy Life ช่วยให้ชีวิตของผู้ใช้สะดวกมากยิ่งขึ้น</p>
        <p>จองที่จอดรถออนไลน์ ชำระค่าบริการออนไลน์ สะดวกรวดเร็ว ปลอดภัย</p>
    </div>

    <!-- Modal Popup -->
    <div id="modal-background"></div>
    <div id="login-modal">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">กรุณาเข้าสู่ระบบ</h2>
        <p class="text-gray-600 mb-4">เพื่อดำเนินการต่อ กรุณาเข้าสู่ระบบหรือลงทะเบียน</p>
        <div class="flex justify-center space-x-4">
            <a href="{% url 'login' %}" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">Login</a>
            <a href="{% url 'register_page' %}" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">Register</a>
        </div>
    </div>

    <!-- Camera Section -->
    <div id="camera-section" class="w-1/2 mt-8 max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-semibold mb-4 text-gray-700 text-center">Live Camera Feed</h2>
        <form method="post" action="{% url 'sc_parking' %}">
            <div class="mb-6"> {% csrf_token %}
                <label for="location-select" class="block text-base font-medium text-gray-600 mb-2">Select Location:</label>
                <select id="location-select" name="location" class="block w-full border-gray-300 rounded-md shadow-sm p-3 text-gray-700">
                    {% for loc in locations %}
                    <option value="{{ loc.id }}" {% if loc == location %} selected {% endif %}>{{ loc.name }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">Submit</button>
            </div>
        </form>
        <div class="overflow-hidden rounded-lg border border-gray-300 bg-gray-100">
            <img id="live-stream" class="w-full h-80 object-cover" src="" alt="Live Stream">
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const liveStream = document.getElementById('live-stream');
            const locationSelect = document.getElementById('location-select');
            const cameraSection = document.getElementById('camera-section');
            const startBtn = document.getElementById('start-btn');
            const loginModal = document.getElementById('login-modal');
            const modalBackground = document.getElementById('modal-background');
            const isAuthenticated = "{{ user.is_authenticated|yesno:'true,false' }}";
            
            liveStream.src = '/live/1/';

            locationSelect.addEventListener('change', function () {
                liveStream.src = `/live/${this.value}/`;
            });

            startBtn.addEventListener('click', function () {
                if (isAuthenticated === "true") {
                    cameraSection.style.display = "block";
                    cameraSection.style.maxHeight = "1000px";
                    cameraSection.style.opacity = "1";
                    cameraSection.scrollIntoView({ behavior: 'smooth' });
                } else {
                    loginModal.style.display = "block";
                    modalBackground.style.display = "block";
                }
            });

            // ปิด modal เมื่อกดที่พื้นหลัง
            modalBackground.addEventListener('click', function () {
                loginModal.style.display = "none";
                modalBackground.style.display = "none";
            });
        });
    </script>
</body>

</html>
